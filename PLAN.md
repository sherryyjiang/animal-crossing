# Animal Crossing-Like Village Game Plan (Next.js + Phaser 3)

## Goals
- 2D village in the browser with a soft pastel visual style.
- Four NPCs with distinct memory filters and personalities.
- Daily loop: talk to each NPC once, end day, get LLM summary.
- Local-only persistence (no backend for now).
- LLM interface swappable (start with gpt-oss on Cerebras).

## Tech Stack
- Frontend: Next.js (app router) + Phaser 3.
- Storage: IndexedDB (preferred) or localStorage (fallback).
- LLM: client-side calls through a thin adapter (configurable).
- Assets: SVG + Phaser Graphics for simple pastel shapes.

## Core Gameplay Loop
1. Player moves around the village and interacts with NPCs.
2. A dialogue UI opens; player chats with the NPC.
3. NPC remembers and updates its memory store.
4. After all NPCs are spoken to, player can end the day.
5. A day summary is generated by the LLM.
6. New day starts, and NPCs reference past memories naturally.

## Village Layout (Soft Pastel)
- Central square + four zones:
  - Bar (bartender)
  - Shop (shopkeeper)
  - Neighborhood house (neighbor)
  - Library (librarian)
- Visual direction:
  - Rounded shapes, gentle gradients, pastel palette.
  - Simple idle animations (bob/blink).
  - Cozy signage for each location.

## Dialogue + Memory System

### NPC Roles
- Bartender: complaints, emotions, stressors.
- Shopkeeper: purchases, preferences, practical details.
- Neighbor: gossip, relationships, social signals.
- Librarian: ideas, books, intellectual interests.

### Memory Data Model (Local)
- Conversation log per NPC:
  - dayIndex, timestamp, speaker, text.
- Memory facts:
  - id, npcId, type, content, tags, salience, createdAt, lastMentionedAt.
- Player model summary per NPC:
  - short evolving profile string.

### Memory Pipeline
1. Extract facts from dialogue (LLM or light heuristic).
2. Score salience (recency + emotion + NPC role).
3. Store high-salience facts in memory.
4. Retrieve top-k memories before next chat.
5. Update NPC-specific player model summary.

### Retrieval Strategy
- Weighted by: recency, salience, type match to NPC role.
- Context window: last conversation + 3-5 top memories.

## LLM Integration
- Adapter interface:
  - generateReply(npcId, context, memories)
  - extractFacts(conversation)
  - summarizeDay(dayLog)
- Prompt templates:
  - Each NPC has a personality prompt + memory filters.
  - Summary prompt references all key events in the day log.
- Config stored locally to switch models later.

## Day Cycle
- Track current day index.
- Each day:
  - NPCs can be spoken to once.
  - End Day button unlocks when all NPCs visited.
  - LLM summary displayed on day transition.
  - Reset "visited" flags for NPCs.

## UI/UX
- Dialogue UI with:
  - NPC name, avatar, rolling text, continue button.
- Day summary modal with "Start New Day" action.
- Minimal HUD: day counter, "End Day" button.

## Implementation Phases

### Phase 1: Project Foundation
- Next.js + Phaser 3 setup.
- Basic scene, camera, player movement.
- NPC sprites with interaction triggers.

### Phase 2: Village + Visuals
- Layout for 4 zones + central plaza.
- Pastel asset set (SVG/Graphics).
- Idle animations for NPCs.

### Phase 3: Dialogue System
- Dialogue UI overlay.
- Basic conversation flow and local logging.

### Phase 4: Memory + LLM
- Local memory storage.
- LLM adapter + prompt templates.
- Retrieval + memory update pipeline.

### Phase 5: Day Cycle + Summary
- Day state management.
- End Day gating.
- LLM-generated summary screen.

### Phase 6: Polish + Testing
- UX refinement, audio ambiance.
- Memory inspection dev panel.
- Stress tests with synthetic chats.

## Risks and Mitigations
- LLM latency: add loading states + cached responses.
- Prompt drift: keep NPC constraints tight and versioned.
- Memory bloat: cap memories per NPC and prune by salience.

## Next Steps (Optional)
- Add weather/seasonal mood shifts.
- Expand village with special events.
- Swap local storage for Convex backend.
